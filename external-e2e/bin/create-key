#!/usr/bin/env ruby
# An api key for e2e testing

# include the "lib" directory
File.expand_path(File.join(__dir__, "..", "lib")).tap {|pwd|
  $LOAD_PATH.unshift(pwd) unless $LOAD_PATH.include?(pwd)
}

# include the "common" directory
File.expand_path(File.join(__dir__, "..", "common")).tap {|pwd|
  $LOAD_PATH.unshift(pwd) unless $LOAD_PATH.include?(pwd)
}

require 'creating-key'
include Fineo::E2E::CreatingKey

options = parse(ARGV, "create-key", "Create an API key\n\tNew key is written to std out.")

require 'aws/api-gateway'
client = Fineo::Aws::ApiGateway.new(options.credentials, options.verbose)

# create the key
key = client.create_key()

# and echo it to the console
require 'json'
map = {
  id: key.id,
  value: key.value,
  name: key.name,
  description: key.description,
  enabled: key.enabled
}

puts JSON.pretty_generate(map)