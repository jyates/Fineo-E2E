#!/usr/bin/env ruby
# Delete an external api key for e2e testing

# include the "lib" directory
File.expand_path(File.join(__dir__, "..", "lib")).tap {|pwd|
  $LOAD_PATH.unshift(pwd) unless $LOAD_PATH.include?(pwd)
}

# include the "common" directory
File.expand_path(File.join(__dir__, "..", "common")).tap {|pwd|
  $LOAD_PATH.unshift(pwd) unless $LOAD_PATH.include?(pwd)
}

require 'optparse'
require 'ostruct'
require 'aws/api-gateway'

options = OpenStruct.new()
OptionParser.new do |opts|
  opts.banner = "Usage: #{File.basename($0)} [options]"
  opts.separator "Delete an API key"

  opts.on('-c', '--credentials FILE', "Location of the credentials FILE to use.") do |s|
    options.credentials = s
  end

  opts.on("--key API_KEY", "API KEY to delete") do |key|
    options.key = key
  end

  opts.on("--strict", "If we should be strict in error handling") do |a|
    options.strict = true
  end

  opts.on_tail("-h", "--help", "Show this message") do
    puts opts
    exit
  end
end.parse!(ARGV)

client = Fineo::Aws::ApiGateway.new(options.credentials, options.verbose)

client.delete_key(options.key, options.strict)
